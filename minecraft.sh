#!bin/sh
# Сохраняем в переменную BASEDIR путь к каталогу, где находится скрипт
BASEDIR=$(dirname $(realpath "$0"))
env_file="$BASEDIR/launch.env"
export RCLONE_CONFIG_DIR="$BASEDIR/rclone"
# Проверка существования файла launch.env
if [ ! -f "$env_file" ]; then
    echo "Файл $env_file не существует."
    read -p "Введите путь до java не ниже 17 версии (напрмиер /usr/lib/jvm/java-21-openjdk/bin/java): " java
    read -p "Введите количество выделяемой оперативной памяти (не менее 4G): " memory
    read -p "Введите имя пользователя: " user
    
# Создание нового файла launch.env
    echo "java=$java" > "$env_file"
    echo "memory=$memory" >> "$env_file"
    echo "user=$user" >> "$env_file"
else
# Чтение значений из файла launch.env
    source "$env_file"
fi

# Условие для синхронизации клиентских модов
if [ -z"$client_mod_synch" ];then
  echo "client_mod_synch=yes">>$env_file
  $BASEDIR/rclone/rclone copy mine_launcher:1.18.2/client_mods $BASEDIR/mods --stats-one-line --progress
elif [ "$client_mod_synch"="yes" ];then
  $BASEDIR/rclone/rclone copy mine_launcher:1.18.2/client_mods $BASEDIR/mods --stats-one-line --progress
fi

# Синхронизация серверных модов
$BASEDIR/rclone/rclone sync mine_launcher:1.18.2/mods $BASEDIR/mods --exclude-from=$BASEDIR/client_mods.txt --stats-one-line --progress --delete-after --create-empty-src-dirs



$java -Djava.library.path=$BASEDIR/natives -Dminecraft.launcher.brand=portablemc -Dminecraft.launcher.version=4.0.3 -cp $BASEDIR/libraries/cpw/mods/securejarhandler/1.0.8/securejarhandler-1.0.8.jar:$BASEDIR/libraries/org/ow2/asm/asm/9.5/asm-9.5.jar:$BASEDIR/libraries/org/ow2/asm/asm-commons/9.5/asm-commons-9.5.jar:$BASEDIR/libraries/org/ow2/asm/asm-tree/9.5/asm-tree-9.5.jar:$BASEDIR/libraries/org/ow2/asm/asm-util/9.5/asm-util-9.5.jar:$BASEDIR/libraries/org/ow2/asm/asm-analysis/9.5/asm-analysis-9.5.jar:$BASEDIR/libraries/net/minecraftforge/accesstransformers/8.0.4/accesstransformers-8.0.4.jar:$BASEDIR/libraries/org/antlr/antlr4-runtime/4.9.1/antlr4-runtime-4.9.1.jar:$BASEDIR/libraries/net/minecraftforge/eventbus/5.0.3/eventbus-5.0.3.jar:$BASEDIR/libraries/net/minecraftforge/forgespi/4.0.15-4.x/forgespi-4.0.15-4.x.jar:$BASEDIR/libraries/net/minecraftforge/coremods/5.0.1/coremods-5.0.1.jar:$BASEDIR/libraries/cpw/mods/modlauncher/9.1.3/modlauncher-9.1.3.jar:$BASEDIR/libraries/net/minecraftforge/unsafe/0.2.0/unsafe-0.2.0.jar:$BASEDIR/libraries/com/electronwill/night-config/core/3.6.4/core-3.6.4.jar:$BASEDIR/libraries/com/electronwill/night-config/toml/3.6.4/toml-3.6.4.jar:$BASEDIR/libraries/org/apache/maven/maven-artifact/3.6.3/maven-artifact-3.6.3.jar:$BASEDIR/libraries/net/jodah/typetools/0.8.3/typetools-0.8.3.jar:$BASEDIR/libraries/net/minecrell/terminalconsoleappender/1.2.0/terminalconsoleappender-1.2.0.jar:$BASEDIR/libraries/org/jline/jline-reader/3.12.1/jline-reader-3.12.1.jar:$BASEDIR/libraries/org/jline/jline-terminal/3.12.1/jline-terminal-3.12.1.jar:$BASEDIR/libraries/org/spongepowered/mixin/0.8.5/mixin-0.8.5.jar:$BASEDIR/libraries/org/openjdk/nashorn/nashorn-core/15.3/nashorn-core-15.3.jar:$BASEDIR/libraries/net/minecraftforge/JarJarSelector/0.3.19/JarJarSelector-0.3.19.jar:$BASEDIR/libraries/net/minecraftforge/JarJarMetadata/0.3.19/JarJarMetadata-0.3.19.jar:$BASEDIR/libraries/cpw/mods/bootstraplauncher/1.0.0/bootstraplauncher-1.0.0.jar:$BASEDIR/libraries/net/minecraftforge/JarJarFileSystems/0.3.19/JarJarFileSystems-0.3.19.jar:$BASEDIR/libraries/net/minecraftforge/fmlloader/1.18.2-40.2.13/fmlloader-1.18.2-40.2.13.jar:$BASEDIR/libraries/com/mojang/logging/1.0.0/logging-1.0.0.jar:$BASEDIR/libraries/com/mojang/blocklist/1.0.10/blocklist-1.0.10.jar:$BASEDIR/libraries/com/mojang/patchy/2.2.10/patchy-2.2.10.jar:$BASEDIR/libraries/com/github/oshi/oshi-core/5.8.5/oshi-core-5.8.5.jar:$BASEDIR/libraries/net/java/dev/jna/jna/5.10.0/jna-5.10.0.jar:$BASEDIR/libraries/net/java/dev/jna/jna-platform/5.10.0/jna-platform-5.10.0.jar:$BASEDIR/libraries/org/slf4j/slf4j-api/1.8.0-beta4/slf4j-api-1.8.0-beta4.jar:$BASEDIR/libraries/org/apache/logging/log4j/log4j-slf4j18-impl/2.17.0/log4j-slf4j18-impl-2.17.0.jar:$BASEDIR/libraries/com/ibm/icu/icu4j/70.1/icu4j-70.1.jar:$BASEDIR/libraries/com/mojang/javabridge/1.2.24/javabridge-1.2.24.jar:$BASEDIR/libraries/net/sf/jopt-simple/jopt-simple/5.0.4/jopt-simple-5.0.4.jar:$BASEDIR/libraries/io/netty/netty-all/4.1.68.Final/netty-all-4.1.68.Final.jar:$BASEDIR/libraries/com/google/guava/failureaccess/1.0.1/failureaccess-1.0.1.jar:$BASEDIR/libraries/com/google/guava/guava/31.0.1-jre/guava-31.0.1-jre.jar:$BASEDIR/libraries/org/apache/commons/commons-lang3/3.12.0/commons-lang3-3.12.0.jar:$BASEDIR/libraries/commons-io/commons-io/2.11.0/commons-io-2.11.0.jar:$BASEDIR/libraries/commons-codec/commons-codec/1.15/commons-codec-1.15.jar:$BASEDIR/libraries/com/mojang/brigadier/1.0.18/brigadier-1.0.18.jar:$BASEDIR/libraries/com/mojang/datafixerupper/4.1.27/datafixerupper-4.1.27.jar:$BASEDIR/libraries/com/google/code/gson/gson/2.8.9/gson-2.8.9.jar:$BASEDIR/libraries/com/mojang/authlib/3.3.39/authlib-3.3.39.jar:$BASEDIR/libraries/org/apache/commons/commons-compress/1.21/commons-compress-1.21.jar:$BASEDIR/libraries/org/apache/httpcomponents/httpclient/4.5.13/httpclient-4.5.13.jar:$BASEDIR/libraries/commons-logging/commons-logging/1.2/commons-logging-1.2.jar:$BASEDIR/libraries/org/apache/httpcomponents/httpcore/4.4.14/httpcore-4.4.14.jar:$BASEDIR/libraries/it/unimi/dsi/fastutil/8.5.6/fastutil-8.5.6.jar:$BASEDIR/libraries/org/apache/logging/log4j/log4j-api/2.17.0/log4j-api-2.17.0.jar:$BASEDIR/libraries/org/apache/logging/log4j/log4j-core/2.17.0/log4j-core-2.17.0.jar:$BASEDIR/libraries/org/lwjgl/lwjgl/3.2.2/lwjgl-3.2.2.jar:$BASEDIR/libraries/org/lwjgl/lwjgl-jemalloc/3.2.2/lwjgl-jemalloc-3.2.2.jar:$BASEDIR/libraries/org/lwjgl/lwjgl-openal/3.2.2/lwjgl-openal-3.2.2.jar:$BASEDIR/libraries/org/lwjgl/lwjgl-opengl/3.2.2/lwjgl-opengl-3.2.2.jar:$BASEDIR/libraries/org/lwjgl/lwjgl-glfw/3.2.2/lwjgl-glfw-3.2.2.jar:$BASEDIR/libraries/org/lwjgl/lwjgl-stb/3.2.2/lwjgl-stb-3.2.2.jar:$BASEDIR/libraries/org/lwjgl/lwjgl-tinyfd/3.2.2/lwjgl-tinyfd-3.2.2.jar:$BASEDIR/libraries/com/mojang/text2speech/1.12.4/text2speech-1.12.4.jar:$BASEDIR/versions/forge-1.18.2-40.2.13/forge-1.18.2-40.2.13.jar -Djava.net.preferIPv6Addresses=system -DignoreList=bootstraplauncher,securejarhandler,asm-commons,asm-util,asm-analysis,asm-tree,asm,JarJarFileSystems,client-extra,fmlcore,javafmllanguage,lowcodelanguage,mclanguage,forge-,forge-1.18.2-40.2.13.jar -DmergeModules=jna-5.10.0.jar,jna-platform-5.10.0.jar,java-objc-bridge-1.0.0.jar -DlibraryDirectory=$BASEDIR/libraries -p $BASEDIR/libraries/cpw/mods/bootstraplauncher/1.0.0/bootstraplauncher-1.0.0.jar:$BASEDIR/libraries/cpw/mods/securejarhandler/1.0.8/securejarhandler-1.0.8.jar:$BASEDIR/libraries/org/ow2/asm/asm-commons/9.5/asm-commons-9.5.jar:$BASEDIR/libraries/org/ow2/asm/asm-util/9.5/asm-util-9.5.jar:$BASEDIR/libraries/org/ow2/asm/asm-analysis/9.5/asm-analysis-9.5.jar:$BASEDIR/libraries/org/ow2/asm/asm-tree/9.5/asm-tree-9.5.jar:$BASEDIR/libraries/org/ow2/asm/asm/9.5/asm-9.5.jar:$BASEDIR/libraries/net/minecraftforge/JarJarFileSystems/0.3.19/JarJarFileSystems-0.3.19.jar --add-modules ALL-MODULE-PATH --add-opens java.base/java.util.jar=cpw.mods.securejarhandler --add-opens java.base/java.lang.invoke=cpw.mods.securejarhandler --add-exports java.base/sun.security.util=cpw.mods.securejarhandler --add-exports jdk.naming.dns/com.sun.jndi.dns=java.naming -Dlog4j.configurationFile=$BASEDIR/assets/log_configs/client-1.12.xml -Xmx$memory -XX:+UnlockExperimentalVMOptions -XX:+UseG1GC -XX:G1NewSizePercent=20 -XX:G1ReservePercent=20 -XX:MaxGCPauseMillis=50 -XX:G1HeapRegionSize=32M cpw.mods.bootstraplauncher.BootstrapLauncher --username $username --version forge-1.18.2-40.2.13 --gameDir $BASEDIR --assetsDir $BASEDIR/assets --assetIndex 1.18 --uuid 2a294c9f1ce9547aa7a4a1ee77bf50a2 --accessToken --clientId --xuid   --launchTarget forgeclient --fml.forgeVersion 40.2.13 --fml.mcVersion 1.18.2 --fml.forgeGroup net.minecraftforge --fml.mcpVersion 20220404.173914
